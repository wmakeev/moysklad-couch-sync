const log = require('debug')('moysklad-couch-sync')

module.exports = function jsonAttachmentS3Export (next) {
  return value => {
    let imageType
    let imageBuffer
    if (value.TYPE_NAME === 'moysklad.goodImage' && value.contents) {
      imageType = value.filename.split(/\./g).slice(-1)[0]
      try {
        imageBuffer = Buffer.from(value.contents, 'base64')
      } catch (e) {
        log(`${value.filename} file content parse failed:`, e.message)
      }
    }
    next(value)
  }
}
