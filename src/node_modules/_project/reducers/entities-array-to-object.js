module.exports = function entitiesArrayToObject (next) {
  return value => {
    let keyProp = 'uuid'
    if (value instanceof Array && value.length && !!value[0][keyProp]) {
      keyProp = ['metadataUuid', 'priceTypeUuid'].find(p => !!value[0][p]) || keyProp
      return next(value.reduce((res, item, index) => {
        item._index = index
        res[item[keyProp]] = item
        return res
      }, { _array: true }))
    } else {
      return next(value)
    }
  }
}
