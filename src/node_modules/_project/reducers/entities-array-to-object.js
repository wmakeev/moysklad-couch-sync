module.exports = function entitiesArrayToObject (next) {
  return value => {
    let keyProp = 'uuid'

    if (value instanceof Array && value.length && !!value[0][keyProp]) {
      let trackArrayPos = true
      keyProp = ['metadataUuid', 'priceTypeUuid'].find(p => {
        if (value[0][p]) {
          trackArrayPos = false
          return true
        } else {
          return false
        }
      }) || keyProp

      return next(value.reduce((res, item, index) => {
        if (trackArrayPos) { item._index = index }
        res[item[keyProp]] = item
        return res
      }, { _array: true }))
    } else {
      return next(value)
    }
  }
}
